from flask import request
from entity.user import User
from dao.userdao import UserDAO
import re
from .md5_fun import md5



#获取前端传过来的注册用的账户名和两次密码
#对密码进行判断一致性判断
#注册用的密码必须是6位以上而且必须包括四部分：数字、小写字母、大写字母、特殊字符
userDAO = UserDAO()
def editpassuser(sess):
    userName = request.form['newusername']
    userPwd  = request.form['oldpassword']
    userPwd1 = request.form['newpassword']
    edit = re.compile(r'^.*(?=.{6,})(?=.*\d)(?=.*[A-Z])(?=.*[a-z])(?=.*[!@#$%^&*? ]).*$')
    userlist = userDAO.getUserinfo(sess)
    if userName != None and userName != '':
        userPwd = md5(userPwd)
        if userlist[0][0] == userPwd:
            if edit.search(userPwd1) :
                user = User()
                user.userName = userName
                userPwd1 = md5(userPwd1)
                user.userPwd  = userPwd1
                result = userDAO.editUserById(user,sess)
                return result
    else:
        userPwd = md5(userPwd)
        if userlist[0][0] == userPwd:
            if edit.search(userPwd1):
                user = User()
                userPwd1 = md5(userPwd1)
                user.userPwd = userPwd1
                result = userDAO.editUserById(user, sess)
                return result